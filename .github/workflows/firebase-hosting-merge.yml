# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge
'on':
  push:
    branches:
      - main
jobs:
  deploy-site:
    runs-on: ubuntu-latest
    steps:
      - id: checkout-main
        name: Checkout Main Branch
        uses: actions/checkout@v3
      - id: create-environment
        name: Create Environment
        run: |
          touch .env.production
          echo VITE_MAPS_EMBED_KEY=${{ secrets.MAPS_EMBED_KEY }} >> .env.production
          echo VITE_API_URL=https://api.stphillipsmbchurch.com >> .env.production
          echo VITE_PAYPAL_ID=${{ secrets.PAYPAL_ID }} >> .env.production
          echo VITE_EMAIL_SERVICE=${{ secrets.EMAIL_SERVICE }} >> .env.production
          echo VITE_EMAIL_TEMPLATE=${{ secrets.EMAIL_TEMPLATE }} >> .env.production
          echo VITE_EMAIL_USER=${{ secrets.EMAIL_USER }} >> .env.production
          echo VITE_RECAPTCHA_KEY=${{ secrets.RECAPTCHA_KEY }} >> .env.production
          cat .env.production
      - id: install-and-build
        name: Install Dependencies and Build Project
        run: npm ci && npm run build
      - id: deploy-firebase
        name: Deploy To Firebase
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_SPMBC_FRONTEND }}'
          channelId: live
          projectId: spmbc-frontend
